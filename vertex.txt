#version 300 es

// MAIN DUTY: process... vertices???
// 3D point in space
// normal vector
// uv: texture coordinate
// Object space
layout(location = 0) in vec4 aPosition;
layout(location = 1) in vec3 aNormal;
//in vec4 aPosition;
// Texture space
//layout(location = 2) in vec2 aTexcoord;
layout(location = 2) in vec4 aTexcoord;

// transform uniforms
uniform mat4 uModelMat;
uniform mat4 uViewMat;
uniform mat4 uProjectionMat;

// Per Vertex: pass final color
//out vec4 vColor;

//Per Fragment pass requirements for final color
out vec4 vNormal;

out vec4 vTexcoord;

void main()
{
	// REQUIRED: write to this variable
	//gl_Position = aPosition;
	
	// pos in world space(not yet correct)
	//vec4 pos_world = uModelMat * aPosition;
	//gl_Position = pos_world;
	
	// pos in camera space (still not correct)
	//vec4 pos_view = uViewMat * pos_world;
	//gl_Position = pos_view;
	
	// Position pipeline
	mat4 modelViewMat = uViewMat * uModelMat;
	vec4 pos_view = modelViewMat * aPosition;
	
	// pos in clip space
	vec4 pos_clip = uProjectionMat * pos_view;
	gl_Position = pos_clip;
	
	// Normal pipeline
	mat3 normalMat = transpose(inverse(mat3(modelViewMat)));
	vec3 normal_view = normalMat * aNormal;
	
	// Texcoord pipeline
	mat4 atlatMat = mat4(0.5, 0.0, 0.0, 0.0,
						 0.0, 0.5, 0.0, 0.0,
						 0.0, 0.0, 1.0, 0.0,
						 0.25, 0.25, 0.0, 1.0);
	vec4 uv_atlas = atlatMat * aTexcoord;
	
	//vColor = vec4(1, 0.5, 0, 1);
	//vColor = aPosition;
	// example: output normal as color
	//vColor = vec4(aNormal * 0.5 + 0.5, 1.0);
	
	// Per Fragment: output data needed for FS to calc final color
	vNormal = vec4(normal_view, 0.0);
	
	//vTexcoord = aTexcoord;
	vTexcoord = uv_atlas;
	
	//gl_Position = uProjectionMat * modelViewMat * aTexcoord;
}